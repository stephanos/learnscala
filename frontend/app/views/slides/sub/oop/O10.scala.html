@*
    TODO:
        - nested classes ?
*@
@implicitSlide = @{ Content.klassen1 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {
            @image("blocks.png", width = 550, clazz = "naked")
        }

        <!-- ################################################################################## -->

        @titleslide(title = "Definition") {

            @sidebyside() {
                @snippet() {
                    @callblock(id = "plane") {
                        |class Employee
                    }
                    @outblock() {
                        |defined class Employee
                    }
                }
            } {
                <ul class="indent30 fragments">
                    <li>
                        <code>class</code> leitet eine Klasse ein
                    </li>
                    <li>
                        <code>Employee</code> ist der Name der Klasse
                    </li>
                    <li>
                        <code>{ }</code> nicht nötig bei leerem Rumpf
                    </li>
                </ul>
            }

            @spacer2()

            @sidebyside() {
                @snippet() {
                    @callblock(reference = "plane") {
                        |new Employee()
                    }
                    @outblock() {
                        |res0: Employee = Employee@@3ee32abc
                    }
                }
            } {
                @snippet() {
                    @callblock() {
                        |new Employee
                    }
                    @outblock() {
                        |res0: Employee = Employee@@50394ec
                    }
                }
            }
            @codesub2() {
                <code>new</code> erstellt eine neue Instanz
            }

            @notes {
                - [STIL] camelCase mit Großbuchstabe - nicht '_' (wie Java)
            }

            @*@infobox(hr = false) {
                <code>class</code> definiert eine Klasse, sie ist standardmäßig öffentlich.
                <code>new</code> erstellt eine Instanz.
            }*@
        }

        <!-- ################################################################################## -->

        @defining("Konstuktor") { title =>

            @titleslide(title = title, subtitle = "primär", head = true) {

                @sidebyside(gap = 10) {

                    @subhead() {
                        Parameter
                    }

                    @snippet() {
                        @sourceblock() {
                            |class Employee(name: String)
                        }
                        @callblock() {
                            |val e = new Employee("Bob")
                        }
                        @outblock() {
                            |e: Employee = Employee@@3ee32abc
                        }
                    }
                    @codesub2() {
                        Parameter stehen direkt an der Klasse
                    }
                } {
                    @subhead() {
                        Rumpf
                    }

                    @snippet() {
                        @sourceblock() {
                            |class Employee(name: String) {
                            |   println("My name is " + name)
                            |}
                        }
                        @callblock() {
                            |val e = new Employee("Bob")
                        }
                        @outblock() {
                            |My name is Bob
                            |e: Employee = Employee@@3ee32abc
                        }
                    }
                    @codesub2() {
                        Anweisungen im Rumpf der Klasse werden bei der Initialisierung ausgeführt
                    }
                }

                @*@infobox() {
                    Der primäre Konstruktor <comment>("primary constructor")</comment>
                    entsteht aus <br/> den Parametern einer Klasse sowie deren Anweisungen im Rumpf.
                }*@

                @notes {
                    - [STIL] Parameter in 1 Zeile wenn möglich
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "sekundär", connector = ":") {

                @snippet() {
                    @sourceblock() {
                        |class Employee(name: String, age: Int) {
                        |
                        |  def this =
                        |    this("Unknown", -1)
                        |
                        |  def this(firstname: String, lastname: String, age: Int) =
                        |    this(firstname + " " + lastname, age)
                        |}
                    }
                    @callblock() {
                        |val e = new Employee("Bob", "Bobster", 35)
                    }
                }
                @codesub2() {
                    zusätzliche Konstruktoren tragen den Namen <code>this</code>
                }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |class Employee(name: String, age: Int) {
                        |
                        |  def this =
                        |     println("initialized")
                        |}
                    }
                    @outblock(error = true) {
                        |error: 'this' expected but identifier found
                    }
                }
                @codesub2() {
                    erste Anweisung muss einen zuvor definierten Konstruktor aufrufen
                }

                @*
                @infobox() {
                    <code>def this</code> leitet einen Konstruktor ein, <code>this(..)</code> ruft ihn auf.
                }

                @warnbox(hr = false) {
                    Ein zusätzlicher Konstruktor <comment>("auxiliary constructor")</comment>
                    muss stets als erste Anweisung einen vor ihm definierten Konstruktor aufrufen.
                }
                *@
            }
        }

        <!-- ################################################################################## -->

        @defining("Felder") { title =>

            @titleslide(title = title, subtitle = "val & var") {

                @spacer()

                @sidebyside(gap = 10) {
                    @sourcecode(id = "empl-mutable") {
                        |class Employee(_name: String) {
                        |   var name = _name
                        |}
                    }
                    @codesub2() {
                        <var>veränderliches</var> Feld
                    }

                    @spacer()

                    @indent() {
                        @snippet() {
                            @callblock(reference = "empl-mutable") {
                                |val e = new Employee("Bob")
                            }
                            @outblock() {
                                |e: Employee = Employee@@404b50ed
                            }
                            @callblock() {
                                |e.name = "Betty"
                            }
                            @outblock() {
                                |e.name: String = Betty
                            }
                        }
                    }
                } {
                    @sourcecode(id = "empl-immutable") {
                        |class Employee(_name: String) {
                        |   val name = _name
                        |}
                    }
                    @codesub2() {
                        <em>unveränderliches</em> Feld
                    }

                    @spacer()

                    @indent() {
                        @snippet() {
                            @callblock(reference = "empl-immutable") {
                                |val e = new Employee("Bob")
                            }
                            @outblock() {
                                |e: Employee = Employee@@1cc17783
                            }
                            @callblock() {
                                |e.name = "Betty"
                            }
                            @outblock(error = true) {
                                |error: reassignment to val
                            }
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Parameter als Felder") {

                @spacer()

                @sourcecode() {
                    |class Employee(val name: String)
                }
                @codesub2() {
                    Feld <code>name</code> mit Lesezugriff
                }

                @spacer2()

                @sourcecode() {
                    |class Employee(var name: String)
                }
                @codesub2() {
                    Feld <code>name</code> mit Lese- und Schreibzugriff
                }
            }
        }

        <!-- ################################################################################## -->

        @titleslide(title = "Sichtbarkeit") {

            @codesplits((60,40)){
                @splitstart() {
                    |class Employee @("{")
                }{
                    <em>Zugriff möglich von:</em>
                }
                @codesplit() {
                    |                 val name = "Bob"
                } {
                    @li{überall}
                }
                @codesplit() {
                    |  protected      val nickname = "Bobby"
                } {
                    @li{<code>Employee</code> und Sub-Klassen}
                }
                @codesplit() {
                    |  private        val salary = 45000
                } {
                    @li{<code>Employee</code>}
                }
                @codesplit() {
                    |  private[this]  val password = "123456"
                } {
                    @li{<code>Employee</code>-Instanz}
                }
                @splitend() {
                    |@("}")
                }(null)
            }

            @*@infobox() {
                Felder einer Klasse sind standardmäßig öffentlich - der Zugriff wird <br/>
                &nbsp;via <code>protected</code> auf Sub-Klassen, <br/>
                &nbsp;via <code>private</code> auf die Klasse und <br/>
                &nbsp;via <code>private[this]</code> auf die Instanz begrenzt.
            }*@
        }

        <!-- ################################################################################## -->

        @defining("Methoden") { title =>

            @titleslide(title = title) {

                @sidebyside(gap = 5) {
                    @snippet() {
                        @sourceblock(id = "empl2") {
                            |class Employee {
                            |
                            |  private var present = false
                            |
                            |  def clockIn() {
                            |    present = true
                            |    println("Hi! I clocked in.")
                            |  }
                            |
                            |  def clockOut() {
                            |    present = false
                            |    println("I clocked out. Bye!")
                            |  }
                            |
                            |  def isInTheOffice: Boolean =
                            |    present
                            |}
                        }
                    }
                } {
                    @spacer()

                    @snippet() {
                        @callblock(reference = "empl2") {
                            |val e = new Employee
                        }
                        @outblock() {
                            |e: Employee = Employee@@2142115
                        }
                        @callblock() {
                            |e.clockIn()
                        }
                        @outblock() {
                            |Hi! I clocked in.
                        }
                        @callblock() {
                            |val atOffice = e.isInTheOffice
                        }
                        @outblock() {
                            |atOffice: Boolean = true
                        }
                        @callblock() {
                            |e.clockOut()
                        }
                        @outblock() {
                            |I clocked out. Bye!
                        }
                    }
                }

                @*@infobox() {
                    Methoden einer Klasse sind standardmäßig öffentlich, <br/>
                    bei nur lesenden Methoden sollte <code>()</code> weggelassen werden.
                }*@

                @notes {
                    - [STIL] öffentliche Methoden sollten Rückgabetyp haben
                    - [STIL] kein get- oder set-Prefix - höchstens 'is-'
                    - [STIL] Variablen an den Anfang, Methoden danach (durch Zeile getrennt)
                    - [STIL] '()' weglassen, außer die Methode verändert den Zustand
                        - [SHOW]? 'isInTheOffice()' (error)
                }
            }

            <!-- ################################################################################## -->

            <!-- TODO: Stil-Übung: konvertiere Klasse (live, zusammen ?) -->

            @titleslide(title = title, subtitle = "Übung") {

                @sidebyside(gap = 10) {

                    @subhead() {
                        Aufgabe
                    }

                    @sourcecode() {
                        |class my_COMPANY {
                        |  private var open: Boolean = true
                        |  def fire_employee = {
                        |    Employees -= 1
                        |  }
                        |  def setClose() = {
                        |    open = false
                        |  }
                        |
                        |  val NamE: String = "Scaloogle"
                        |
                        |  def say_HELLO = {
                        |
                        |    return println {
                        |      "Welcome to " + name }
                        |  }
                        |
                        |  private var Employees: Int = 101
                        |}
                    }
                } {
                    @subhead() {
                        Lösung
                    }

                    @sourcecode(linebyline = true) {
                        |class MyCompany {
                        |  val name = "Scaloogle"
                        |  private var open = true
                        |  private var employees = 101
                        |
                        |  def close() {
                        |    open = false
                        |  }
                        |
                        |  def sayHello() {
                        |    println("Welcome to" + name)
                        |  }
                        |
                        |  def fireEmployee() {
                        |    employees -= 1
                        |  }
                        |}
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "überladen", connector = ":") {

                <!-- TODO: Problem mit default Parameter -->

                @spacer()

                @sidebyside(gap = 10) {
                    @snippet() {
                        @sourceblock(hl = "6") {
                            |class Employee(val name: String) {
                            |
                            |  def fire(nickname: String) =
                            |    name + ", you are fired!"
                            |
                            |  def fire =
                            |    fire(name)
                            |}
                        }
                        @outblock(error = true) {
                            |error: overloaded method fire
                            |       needs result type
                        }
                    }
                    @codesub2() {
                        überladene Methoden <var>ohne</var> Rückgabetyp
                    }
                } {
                    @snippet() {
                        @sourceblock(hl = "6") {
                            |class Employee(val name: String) {
                            |
                            |  def fire(nickname: String) =
                            |    name + ", you are fired!"
                            |
                            |  def fire: String =
                            |    fire(name)
                            |}
                        }
                        @outblock() {
                            |defined class Employee
                        }
                    }
                    @codesub2() {
                        überladene Methoden <em>mit</em> Rückgabetyp
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @titleslide(title = "Uniform Access Principle") {

            <!--
                TODO
                    http://docs.scala-lang.org/style/naming-conventions.html#accessorsmutators
            -->

            @sidebyside(gap = 10) {
                @snippet(id = "empl") {
                    @sourceblock() {
                        |class Employee(val name: String,
                        |               var age: Int) {
                        |  val salary = 40000
                        |}
                    }
                }

                @spacer()

                @outcode(lang = "java") {
                   |public class Employee extends [...] {
                   |
                   |  private final String name;
                   |  public String name();      // get
                   |
                   |  private final int salary;
                   |  public int salary();       // get
                   |
                   |  private int age;
                   |  public int age();          // get
                   |  public void age_$eq(int);  // set
                   |}
                }

                @codesub2() {
                    <code>val</code> erhält eine Get-Methode,<br/>
                    <code>var</code> erhält Get- @uline("und") Set-Methoden

                    @*Scala generiert überschreibbare, öffentliche Zugriffsmethoden:<br/>*@
                }
            } {
                @spacer()

                @snippet() {
                    @callblock(reference = "empl") {
                        |val e = new Employee("Bob", 35)
                    }
                    @outblock() {
                        |e: Employee = Employee@@53a1d1a8
                    }
                    @callblock() {
                        |println(e.name)
                    }
                    @outblock() {
                        |Bob
                    }
                    @callblock() {
                        |println(e.salary)
                    }
                    @outblock() {
                        |40000
                    }
                    @callblock() {
                        |e.age = e.age - 1
                    }
                    @outblock() {
                        |e.age: Int = 34
                    }
                }
            }

            @notes {
                - [STIL]
            }
        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}