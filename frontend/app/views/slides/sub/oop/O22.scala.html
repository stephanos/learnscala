@*
    TODO:
        - nested classes ?
*@
@defining("Klassen II") { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {
        }

        <!-- ################################################################################## -->

        @defining("Case Class") { title =>

            @slide(title = title) {
                @sidebyside((50,50)) {
                    @sourcecode(id = "simple_class") {
                        |class HttpStatus (val code: Int)
                    }
                } {
                    @sourcecode(id = "case_class") {
                        |case class HttpStatus (code: Int)
                    }
                    @codesub2() {
                        <code>case</code> Schlüsselwort steht vor <code>class</code>
                    }
                }

                @spacer()

                @sidebyside((50,50)) {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "simple_class", id = "simple_class_step1") {
                            |val s = new HttpStatus(404)
                        }
                    }
                } {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "case_class", id = "case_class_step1") {
                            |val s = HttpStatus(404)
                        }
                    }
                    @codesub2() {
                        Instanziierung via Companion Object
                    }
                }

                @spacer_half()

                @sidebyside((50,50)) {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "simple_class_step1") {
                            |s.code
                        }
                        @outblock() {
                            |res0: Int = 404
                        }
                    }
                } {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "case_class_step1") {
                            |s.code
                        }
                        @outblock() {
                            |res0: Int = 404
                        }
                    }
                    @codesub2() {
                        Parameter <code>code</code> ist ein Feld der Klasse
                    }
                }

                @spacer_half()

                @sidebyside((50,50)) {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "simple_class_step1") {
                            |s.toString
                        }
                        @outblock() {
                            |res0: String = HttpStatus@@4c1b7143
                        }
                    }
                } {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "case_class_step1") {
                            |s.toString
                        }
                        @outblock() {
                            |res0: String = HttpStatus(404)
                        }
                    }
                    @codesub2() {
                        <code>toString</code> liefert ein lesbares Ergebnis
                    }
                }

                @spacer_half()

                @sidebyside((50,50)) {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "simple_class_step1", id = "simple_class_step3") {
                            |val eq = s.equals (new HttpStatus(404))
                        }
                        @outblock() {
                            |eq: Boolean = false
                        }
                    }
                } {
                    @snippet(clazz = "slim") {
                        @sourceblock(reference = "case_class_step1", id = "simple_class_step3") {
                            |val eq = s.equals (HttpStatus(404))
                        }
                        @outblock() {
                            |eq: Boolean = true
                        }
                    }
                    @codesub2() {
                        <code>equals</code> funktioniert
                    }
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title) {
                @sidebyside((45,55)) {
                    @sourcecode() {
                        |class HttpStatus (val code: Int) {
                        |
                        |  override def toString =
                        |    "HttpStatus(" + code + ")"
                        |
                        |  override def hashCode =
                        |    code.hashCode
                        |
                        |  def copy(code: Int = code) =
                        |    new HttpStatus(code)
                        |
                        |  override def equals(other: Any) =
                        |    other match {
                        |      case status: HttpStatus =>
                        |        this.code == status.code
                        |      case _ => false
                        |    }
                        |}
                        |
                        |object HttpStatus {
                        |  def apply(code: Int) =
                        |    new HttpStatus(code)
                        |}
                    }
                } {
                    @sourcecode(id = "case_class") {
                        |case class HttpStatus (code: Int)
                    }

                    @spacer()

                    @codenote2() {
                        <code>case</code> bewirkt:
                        @spacer_half()
                        <ul class="indent fragments">
                            <li>
                                Parameter werden zu öffentlichen, unveränderlichen Feldern
                            </li>
                            <li>
                                Aufruf von <code>equals()</code> vergleicht strukturell
                            </li>
                            <li>
                                <code>toString()</code> gibt Klassenname und Parameterwerte aus
                            </li>
                            <li>
                                Factory-Methode <code>apply</code> in Companion Object
                            </li>
                            @*<li>
                                Extraktor-Methode <code>unapply</code> in Companion Object
                            </li>*@
                            <li>
                                Methode <code>copy</code> erstellt Kopien
                            </li>
                        </ul>
                    }
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "Vererbung") {

                @snippet() {
                    @sourceblock(id = "case_point") {
                        |case class Employee(name: String)
                        |
                        |case class Programmer(name2: String, knowsScala: Boolean)
                        |   extends Employee(name2)
                    }
                    @outblock(error = true) {
                        |warning: case class `class Programmer'
                        |         has case ancestor `class Employee'.
                        |         Case-to-case inheritance has potentially
                        |         dangerous bugs which are unlikely to be fixed.
                    }
                }
                @codesub2() {
                    <var>Warnung</var> bei Vererbung einer Case Class
                }

                @spacer()

                @snippet() {
                    @callblock(reference = "case_point") {
                        |Programmer("Bob", true).copy()
                    }
                    @outblock() {
                        |res2: Employee = Employee(Bob)
                    }
                }
                @codesub2() {
                    <var>Problem:</var> <code>copy</code> liefert Basis-Klasse
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "Pattern Matching") {

                @sidebyside() {
                    @snippet() {
                        @sourceblock(id = "empl") {
                            |case class Employee (name: String,
                            |                     age: Int)
                        }
                    }
                } {

                    @snippet() {
                        @sourceblock(reference = "empl", hl = "3") {
                            |def shouldRetire(empl: Employee) =
                            |  empl match {
                            |    case Employee(n, a) if(a > 66) => true
                            |    case _ => false
                            |  }
                        }
                    }

                    @codesub2() {
                        <em>Konstruktor Pattern</em> lässt Case Class zerlegen
                    }

                    @spacer_half()

                    @snippet() {
                        @sourceblock(reference = "empl", hl = "3") {
                            |def shouldRetire(empl: Employee) =
                            |  empl match {
                            |    case Employee(n, 65) => true
                            |    case _ => false
                            |  }
                        }
                    }

                    @codesub2() {
                        Verwendung der Konstante <code>65</code> (<em class="nobreak">Konstante Pattern</em>)
                    }

                    @spacer_half()

                    @snippet() {
                        @sourceblock(reference = "empl", hl = "3") {
                            |def shouldRetire(empl: Employee) =
                            |  empl match {
                            |    case Employee(_, a) if(a > 66) => true
                            |    case _ => false
                            |  }
                        }
                    }

                    @codesub2() {
                        Parameter können mit Wildcard <code>_</code> ignoriert werden
                    }
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "sealed") {

                @sourcecode(id = "case_class_match") {
                    |sealed abstract class Employee { val age: Int }
                    |
                    |case class Boss(age: Int) extends Employee
                    |
                    |case class Developer(age: Int, knowsScala: Boolean)
                    |   extends Employee
                }

                @spacer()

                @sourcecode(id = "match_salary", linebyline = true, reference = "case_class_match") {
                    |def getSalary(e: Employee) =
                    |  e match {
                    |    case Boss(age) if(age > 50) => 130000
                    |    case p: Boss                => 80000 + (p.age * 1000)
                    |    case Developer(_, true)     => 50000
                    |    case Developer(_, _)        => 40000
                    |  }
                }

                @spacer()

                @sidebyside() {
                    @snippet() {
                        @callblock(reference = "match_salary") {
                            |val e = Boss(25)
                            |val s = getSalary(e)
                        }
                        @outblock() {
                            |s: Int = 105000
                        }
                    }
                } {
                    @snippet() {
                        @callblock() {
                            |val e = Developer(30, false)
                            |val s = getSalary(e)
                        }
                        @outblock() {
                            |s: Int = 40000
                        }
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @uebung("030")
    }
}