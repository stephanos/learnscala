<!--
   http://scalatutorial.wordpress.com/2011/12/04/teil-14-1-varianzen/
   http://coding-time.blogspot.de/2011/05/covariance-and-contravariance-simple.html
   http://entwickler.de/zonen/portale/psecom,id,101,online,3475,p,0.html
   http://www.scala-lang.org/node/129
   http://www.naildrivin5.com/scalatour/wiki_pages/TypeVariance
-->
@implicitSlide = @{ Content.generics1 }

@defining(implicitSlide.label) { implicit topic =>
    
    @layout.slidedeck(topic) {
        
        @slidehead() {
            @topic
        } {
        }

        <!-- ################################################################################## -->

        @slide() {

            @sidebyside(gap = 10) {
                @sourcecode() {
                    |class myClass[T] {
                    |   // ...
                    |}
                }
                @codesub2() {
                    <em>Klasse</em> mit 1 Typ-Parameter
                }

                @spacer2()

                @sourcecode() {
                    |trait myTrait[T, S] {
                    |   // ...
                    |}
                }
                @codesub2() {
                    <em>Trait</em> mit 2 Typ-Parametern
                }
            } {
                @sourcecode() {
                    |def myMethod[A, B, C] {
                    |   // ...
                    |}
                }
                @codesub2() {
                    <em>Methode</em> mit 3 Typ-Parametern
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |object myObject[T] {
                        |   // ...
                        |}
                    }
                    @outblock(error = true) {
                        |error: ';' expected but '[' found
                    }
                }
                @codesub2() {
                    <var>Objekte</var> unterstützen keine Typ-Parameter
                }
            }
        }

        <!-- ################################################################################## -->

        @*
        @slide(title = "Beispiel") {

            @sourcecode(linebyline = true) {
                |class Config[T] (key: String, value: T) {
                |
                |  def get: T = value
                |
                |  def isEqualTo (k: String, v: T) =
                |    key == k && value == v
                |
                |  override def toString =
                |    key + "=" + value
                |}
            }
            @codesub2() {
                <code>T</code> als Parameter- und Rückgabetyp
            }
        }
        *@

        <!-- ################################################################################## -->

        @slide(title = "Modell") {

            @snippet() {
                @sourceblock(id = "crew") {
                    |trait Crew
                    |
                    |class Pilot extends Crew
                    |class CoPilot extends Pilot
                    |
                    |class Stewardess() extends Crew
                }
            }
        }

        <!-- ################################################################################## -->

        @slide(title = "Inferenz") {

            @sourcecode(id = "cockpit2", reference = "crew") {
                |case class Cockpit[T, S](left: T, right: S)
            }

            @spacer2()

            @snippet() {
                @sourceblock(reference = "cockpit2") {
                    |val c: Cockpit[Pilot, Pilot] =
                    |   new Cockpit[Pilot, Pilot](new Pilot, new Pilot)
                }
                @outblock() {
                    |c: Cockpit[Pilot,Pilot] = Cockpit(Pilot,Pilot)
                }
            }

            @iseq()

            @snippet() {
                @sourceblock(reference = "cockpit2") {
                    |val c =
                    |   new Cockpit[Pilot, Pilot](new Pilot, new Pilot)
                }
                @outblock() {
                    |c: Cockpit[Pilot,Pilot] = Cockpit(Pilot,Pilot)
                }
            }

            @iseq()

            @snippet() {
                @sourceblock(reference = "cockpit2") {
                    |val c = new Cockpit (new Pilot, new Pilot)
                }
                @outblock() {
                    |c: Cockpit[Pilot,Pilot] = Cockpit(Pilot,Pilot)
                }
            }
            @codesub2() {
                Typ-Parameter werden abgeleitet
            }
        }

        <!-- ################################################################################## -->

        @slide(title = "Typenüberprüfung") {

            @sourcecode(id = "cockpit-check", reference = "crew") {
                |case class Cockpit[T](left: T, right: T) {
                |
                |   require(left.isInstanceOf[Pilot] &&
                |           right.isInstanceOf[Pilot])
                |}
            }
            @codesub2() {
                <code>isInstanceOf</code> überprüft den Typ
            }

            @spacer2()

            @indent() {

                @snippet() {
                    @sourceblock(reference = "cockpit-check") {
                        |val c = new Cockpit (new Pilot, new Pilot)
                    }
                    @outblock() {
                        |c: Cockpit[Pilot,Pilot] = Cockpit(Pilot,Pilot)
                    }
                }

                @spacer()

                @snippet() {
                    @sourceblock(reference = "cockpit-check") {
                        |val c = new Cockpit (new Pilot, new Stewardess)
                    }
                    @outblock(error = true) {
                        |java.lang.IllegalArgumentException: requirement failed
                        |    at scala.Predef$.require(Predef.scala:145)
                        |    at Cockpit.&lt;init&gt;(&lt;console&gt;:16)
                    }
                }
                @codesub2() {
                    Fehler wird erst zur Laufzeit erkannt
                }
            }
        }

        <!-- ################################################################################## -->

        @slide(title = "Upper Bound") {

            @sourcecode(id = "cockpit-upper", reference = "crew") {
                |case class Cockpit[T &lt;: Pilot](left: T, right: T)
            }
            @codesub2() {
                <code>T</code> muss mindestens vom Typ <code>Pilot</code> sein
            }

            @spacer2()

            @indent() {

                @snippet() {
                    @callblock(reference = "cockpit-upper") {
                        |new Cockpit(new Pilot, new CoPilot)
                    }
                    @outblock() {
                        |res0: Cockpit[Pilot,CoPilot] = Cockpit(Pilot,CoPilot)
                    }
                }
                @codesub2() {
                    <code>CoPilot</code> und <code>Pilot</code> <em>sind erlaubt</em>
                }

                @spacer()

                @snippet() {
                    @callblock(reference = "cockpit-upper") {
                        |new Cockpit(new Pilot, new Stewardess)
                    }
                    @outblock(error = true) {
                        |error: inferred type arguments [Crew]
                        |       do not conform to class Cockpit's
                        |       type parameter bounds [T &lt;: Pilot]
                    }
                }
                @codesub2() {
                    <code>Stewardess</code> ist <var>nicht erlaubt</var>
                }
            }
        }

        <!-- ################################################################################## -->

        @*
        @slide(title = "Lower Bound") {

            @sourcecode(id = "cockpit-lower", reference = "crew") {
                |case class Cockpit[T &lt;: Pilot](left: T, right: T) {
                |
                |  def replaceLeft[R >: T](newLeft: R) =
                |    new Cockpit(newLeft, right)
                |}
            }
            @codesub2() {
                <code>R</code> muss
            }

            @spacer()

            @indent() {

                @snippet() {
                    @callblock(reference = "cockpit-lower") {
                        |val b = new Cockpit(new Pilot, new CoPilot)
                    }
                    @outblock() {
                        |b: Cockpit[Pilot,CoPilot] = Cockpit(Pilot,CoPilot)
                    }
                    @callblock() {
                        |val b2 = b.replaceLeft(new Stewardess)
                    }
                    @outblock() {
                        |b2: Cockpit[Apple] = Cockpit(Apple,CandyApple)
                    }
                }
                @codesub2() {

                }
            }
        }
        *@

        <!-- ################################################################################## -->

        @*
        @defining("Varianz") { title =>

            @slide(title = title, subtitle = "Invarianz") {

                @sourcecode(id = "cockpit-invariant", reference = "crew") {
                    |case class Cockpit[T](left: T, right: T) {
                    |
                    |  def swap(newItem: T) =
                    |    new Cockpit(newItem)
                    |}
                }

                @spacer()

                @sidebyside() {
                    @sourcecode(reference = "cockpit-invariant") {
                        |val b1 = new Cockpit(Apple())
                    }
                } {
                    @sourcecode(reference = "cockpit-invariant") {
                        |val b2: Cockpit[Fruit] = new Cockpit(Apple())
                    }
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "Kovarianz") {

            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "Kontravarianz") {

            }
        }
        *@

        <!-- ################################################################################## -->

        @*
        @slide(title = "Type Erasure") {
            @sourcecode(reference = "crew") {
                |case class Cockpit[T](left: T, right: T)
                |
                |def canFlyPlane(c: Cockpit[_]) = c match {
                |    case c: Cockpit[Pilot] => true
                |    case _ => false
                |}
                |
                |canFlyPlane(new Cockpit)
            }
        }
        *@

        <!-- ################################################################################## -->
        
        @uebung(implicitSlide.id)
    }   
}