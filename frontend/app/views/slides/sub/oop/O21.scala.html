<!--
   TODO
        def do(Foo with Bar)
-->
@implicitSlide = @{ Content.traits }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {
        }

        <!-- ################################################################################## -->

        @slide(title = "Interface") {

            @snippet() {
                @sourceblock(id = "logger1") {
                    |trait Logger {
                    |  def log (msg: String)
                    |}
                }
                @outblock() {
                    |defined trait Logger
                }
                @callblock() {
                    |new Logger
                }
                @outblock(error = true) {
                    |error: trait Logger is abstract;
                    |       cannot be instantiated
                }
            }
            @codesub2() {
                Trait mit abstrakter Methode
            }

            @spacer_half()

            @snippet() {
                @sourceblock(reference = "logger1") {
                    |class SimpleLogger extends Logger {
                    |  def log (msg: String) {
                    |    println (msg)
                    |  }
                    |}
                }
                @outblock() {
                    |defined class SimpleLogger
                }
                @callblock() {
                    |new SimpleLogger().log ("MAYDAY!")
                }
                @outblock() {
                    |MAYDAY
                }
            }
            @codesub2() {
                Trait wird vererbt
            }

            @*@infobox() {
                Ein Trait kann wie ein Java <code>interface</code> mittels <code>extends</code> vererbt werden
                und abstrakte Methoden definieren.
            }*@
        }

        <!-- ################################################################################## -->

        @slide(title = "Interface++") {

            @snippet() {
                @sourceblock(id = "logger2") {
                    |trait Logger {
                    |  def log (msg: String) {
                    |     println (msg)
                    |  }
                    |}
                }
                @outblock() {
                    |defined trait Logger
                }
                @callblock() {
                    |new Logger
                }
                @outblock(error = true) {
                    |error: trait Logger is abstract;
                    |       cannot be instantiated
                }
            }
            @codesub2() {
                Trait mit konkreter Methode
            }

            @spacer()

            @snippet() {
                @sourceblock(reference = "logger2") {
                    |class Plane extends Logger {
                    |  log ("Ready for take-off")
                    |}
                }
                @callblock() {
                    |new Plane()
                }
                @outblock() {
                    |Ready for take-off
                }
            }

            @*@infobox() {
                Ein Trait kann - im Unterschied zu einem Interface - implementierte Methoden enthalten.
            }*@
        }

        <!-- ################################################################################## -->

        @slide(title = "Hierarchie") {

            @snippet() {
                @sourceblock(id = "log1") {
                    |trait Logger {
                    |  def log (msg: String) {
                    |    println (msg)
                    |  }
                    |}
                }
            }

            @spacer()

            @indent() {

                @snippet() {
                    @sourceblock(id = "secret-log1", reference = "log1") {
                        |trait SecretLogger extends Logger {
                        |  def secretLog (msg: String) {
                        |    log (msg.reverse)
                        |  }
                        |}
                    }
                }

                @spacer()

                @indent() {

                    @snippet() {
                        @sourceblock(reference = "secret-log1") {
                            |class Plane extends SecretLogger {
                            |  secretLog ("VIP is on board")
                            |}
                        }
                    }
                    @codesub2() {
                        Trait kann von einem anderen Trait erben
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @slide(title = "Rich Interface") {

            @snippet() {
                @sourceblock(id = "logger3") {
                    |trait Logger {
                    |  def log (msg: String)
                    |
                    |  def info(msg: String) { log ("INFO: " + msg) }
                    |  def warn(msg: String) { log ("WARN: " + msg) }
                    |}
                }
            }

            @spacer()

            @indent() {

                @snippet() {
                    @sourceblock(reference = "logger3") {
                        |class Plane extends Logger {
                        |  info("Ready for take-off")
                        |
                        |  def log (msg: String) {
                        |    println (msg)
                        |  }
                        |}
                    }
                    @callblock() {
                        |new Plane()
                    }
                    @outblock() {
                        |INFO: Ready for take-off
                    }
                }
            }

            @*@infobox() {
                Ein Trait kann mehrere implementierte Hilfsmethoden haben,
                die ein paar wenige abstrakte Methoden aufrufen <comment>("rich interfaces")</comment>.
            }*@
        }

        <!-- ################################################################################## -->

        @slide(title = "with") {

            @snippet(id = "logger4") {
                @sourceblock() {
                    |trait Logger {
                    |  def log (msg: String) {
                    |    println (msg)
                    |  }
                    |}
                }
            }

            @spacer_half()

            @snippet(id = "secret-logger2") {
                @sourceblock(reference = "logger4") {
                    |trait SecretLogger {
                    |  def secretLog (msg: String) {
                    |    println (msg.reverse)
                    |  }
                    |}
                }
            }

            @spacer()

            @indent() {
                @snippet() {
                    @sourceblock(reference = "secret-logger2") {
                        |class Plane extends Logger with SecretLogger {
                        |
                        |  secretLog ("VIP is on board")
                        |}
                    }
                }
                @codesub2() {
                    Mehrere Traits können vererbt werden
                }
            }

            @*@infobox() {
                Bei Vererbung mehrere Traits steht immer zuerst das <code>extends</code> - egal ob Klasse oder Trait -
                und alle folgenden Traits werden via <code>with</code> abgetrennt.
            }*@
        }

        <!-- ################################################################################## -->

        @slide(title = "Instanziierung") {

            @snippet() {
                @sourceblock(id = "engine") {
                    |trait Engine { println ("Engine ready") }
                }
            }

            @spacer()

            @sidebyside() {
                @snippet() {
                    @sourceblock(reference = "engine") {
                        |class Plane extends Engine {
                        |  println ("Ready for take-off")
                        |}
                    }
                    @callblock() {
                        |new Plane
                    }
                    @outblock() {
                        |Engine ready
                        |Ready for take-off
                    }
                }
            } {
                @snippet() {
                    @sourceblock(reference = "engine") {
                        |class Plane {
                        |  println ("Ready for take-off")
                        |}
                    }
                    @callblock() {
                        |new Plane with Engine
                    }
                    @outblock() {
                        |Ready for take-off
                        |Engine ready
                    }
                }
                @codesub2() {
                    Trait wird erst bei Instanziierung hinzugefügt
                }
            }

            @*@infobox() {
                Ein Trait kann auch erst bei der Erstellung einer Instanz "dazu gemixt" werden.
            }*@
        }

        <!-- ################################################################################## -->

        @slide(title = "stackable") {

            @sidebyside() {
                @spacer2() @spacer()

                @snippet(id = "logger5") {
                    @sourceblock(reference = "plane_log_ready") {
                        |trait Logger {
                        |
                        |  def log (msg: String) {
                        |    println (msg)
                        |  }
                        |}
                    }
                }
            } {
                @snippet(id = "timed_logger") {
                    @sourceblock() {
                        |trait TimedLog extends Logger {
                        |
                        |  override def log (msg: String) {
                        |    val now = java.util.Date
                        |    super.log (now + " " + msg)
                        |  }
                        |}
                    }
                }

                @spacer_half()

                @snippet(id = "upper_logger") {
                    @sourceblock(reference = "timed_logger") {
                        |trait UpperLog extends Logger {
                        |
                        |  override def log (msg: String) {
                        |    super.log (msg.toUpperCase)
                        |  }
                        |}
                    }
                }
            }

            @spacer2()

            @sidebyside() {
                @snippet(clazz = "slim") {
                    @callblock(reference = "upper_logger") {
                        |new Plane with TimedLog with UpperLog
                    }
                    @outblock() {
                        |Sun Jan 01 00:00:00 2012 READY FOR TAKE-OFF
                    }
                }
            } {
                @snippet(clazz = "slim") {
                    @callblock(reference = "upper_logger") {
                        |new Plane with UpperLog with TimedLog
                    }
                    @outblock() {
                        |SUN JAN 01 00:00:00 2012 READY FOR TAKE-OFF
                    }
                }
            }

            @*@infobox() {
                Beim Aufruf einer Methode in einer Klasse mit <code>traits</code> wird
                die Methode im rechtesten Trait zuerst, mit <code>super</code> dann die Methode im Trait links davon aufgerufen.
            }*@
        }

        <!--
            - abstract class or trait ?
        -->

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}