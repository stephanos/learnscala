<!--
    - http://twitter.github.com/scala_school/java.html
    - Pragmatic Programming Scala, page 156
    - Programming in Scala, page 710
    - Programming Scala, page 369

    TODO
        - generics
        - boxing ?
        - Sichtbarkeit ?
-->

@defining("Interoperabilität") { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {
            Wie man mit <var>Java</var> gut auskommt
        }

        <!-- ################################################################################## -->

        @slide() {
            @sidebyside((50,50)) {
                <h3><em>Scala</em> -> <var>Java</var></h3>

                <ul class="indent">
                    <li class="fragment">
                        fast reibungslos,<br/>
                        mit einer Ausnahme:
                        @spacer_half()
                        <ul class="indent">
                            <li>Kollektionen</li>
                        </ul>
                    </li>
                </ul>
            } {
                <h3><var>Java</var> -> <em>Scala</em></h3>
                <ul class="indent">
                    <li class="fragment">
                        gut - speziell für Kompatibilität optimiert
                    </li>
                    <li class="fragment">
                        Spezialfälle:
                        @spacer_half()
                        <ul class="indent">
                            <li>Methoden</li>
                            <li>Felder</li>
                            <li>Objekte</li>
                            <li>Traits</li>
                            <li>Ausnahmen</li>
                            <li>Funktionen</li>
                        </ul>
                    </li>
                    <li class="fragment">
                        @underline("Hilfreich"):
                        Tool <var>javap</var> (aus dem JDK) kann Bytecode von Scala-Klassen dekompilieren
                    </li>
                </ul>
            }
        }

        <!-- ################################################################################## -->

        @defining(<span><em>Scala</em> -> <var>Java</var></span>) { title =>

            <!-- ################################################################################## -->

            @defining("Kollektionen") { subtitle =>
                @headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    <!--
                        http://stackoverflow.com/questions/8301947/what-is-the-difference-between-javaconverters-and-javaconversions-in-scala
                    -->
                    @snippet() {
                        @callblock() {
                            |import scala.collection.JavaConversions._
                            |val javaList: java.util.List[Int] = List(1, 2, 3)
                        }
                        @outblock() {
                            |javaList: java.util.List[Int] = [1, 2, 3]
                        }
                        @callblock() {
                            |javaList.foreach(print)
                        }
                        @outblock() {
                            |123
                        }
                    }
                    @codesub() {
                        <code>JavaConversions</code> enthält Implicits zur automatischen Umwandlung zwischen Kollektionen
                        aus Scala und Java <comment class="nobreak">(dabei wird ein Wrapper verwendet)</comment>
                    }

                    @spacer()

                    @snippet() {
                        @callblock() {
                            |import scala.collection.JavaConverters._
                            |val javaList = List(1, 2, 3).asJava
                        }
                        @outblock() {
                            |javaList: java.util.List[Int] = [1, 2, 3]
                        }
                        @callblock() {
                            |val scalaList = javaList.asScala
                        }
                        @outblock() {
                            |scalaList: scala.collection.mutable.Buffer[Int] = Buffer(1, 2, 3)
                        }
                    }
                    @codesub() {
                        <code>JavaConverters</code> erweitert Kollektionen um die Methoden <code>asScala</code> bzw. <code>asJava</code>
                        zur expliziten Umwandlung
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining(<span><var>Java</var> -> <em>Scala</em></span>) { title =>

            <!-- ################################################################################## -->

            @defining("Klassen") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "") {
                    @title: @subtitle
                } {
                    @sidebyside((47,53)) {
                        @sourcecode() {
                            |class Book
                        }
                    } {
                        @outcode() {
                            |public class Book
                            |  extends java.lang.Object {
                            |
                            |    public Book();
                            |}
                        }
                        @codesub() {
                            jede Scala-Klasse erbt automatisch von <code>java.lang.Object</code>
                        }
                    }

                    @spacer()

                    @sidebyside((47,53)) {
                        @sourcecode() {
                            |class Book(title: String)
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |
                            |    public Book(java.lang.String);
                            |}
                        }
                    }

                    @spacer_half()
                }
            }

            <!-- ################################################################################## -->

            @defining("Methoden") { subtitle =>

                @*
                @headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "") {
                    @title: @subtitle
                } {
                    TODO
                        - static
                        - currying
                }*@

                <!-- ################################################################################## -->

                @headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "Operatoren") {
                    @title: @subtitle
                } {
                    @sidebyside((35,60)) {
                        @sourcecode() {
                            |abstract class Operators {
                            |
                            |
                            |  def >()
                            |  def <()
                            |  def +()
                            |  def -()
                            |
                            |  def ?()
                            |  def &()
                            |  def !()
                            |  def %()
                            |  def ::()
                            |}
                        }
                    } {
                        @outcode() {
                            |public abstract class Operators extends [..] {
                            |  public Operators();
                            |
                            |  public abstract void $greater();
                            |  public abstract void $less();
                            |  public abstract void $plus();
                            |  public abstract void $minus();
                            |
                            |  public abstract void $qmark();
                            |  public abstract void $amp();
                            |  public abstract void $bang();
                            |  public abstract void $percent();
                            |  public abstract void $colon$colon();
                            |}
                        }
                        @codesub() {
                            Symbole werden übersetzt in <var>Java</var>-kompatible Bezeichnungen
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("Felder") { subtitle =>

                @*@headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    @sidebyside((47,53)) {
                        @sourcecode() {
                            |class Book(val title: String)
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private final java.lang.String title;
                            |  public java.lang.String title();
                            |}
                        }
                        @codesub() {
                            <em>val</em> resultiert in einer privaten Variable<br/>
                            und einer gleichnamigen, öffentlichen Zugriffsmethode
                        }
                    }

                    @spacer()

                    @sidebyside((47,53)) {
                        @sourcecode() {
                            |class Book(var title: String)
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private final java.lang.String title;
                            |  public java.lang.String title();
                            |  public void title_$eq(java.lang.String);
                            |}
                        }
                        @codesub() {
                            <em>var</em> erhält zusätzlich eine schreibende Methode
                            <span class="nobreak">mit dem Suffix <code>_=</code></span> (entspricht <code>_$eq</code> in Java)
                        }
                    }
                }*@

                <!-- ################################################################################## -->

                @*@headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "Get & Set") {
                    @title: @subtitle
                } {
                    @sidebyside((50,50)) {
                        @sourcecode() {
                            |import scala.reflect.BeanProperty
                            |
                            |class Book(@@BeanProperty val title:String)
                        }
                        @codesub() {
                            <code>@@BeanProperty</code> erstellt eine get-Methode für <em>val</em>
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private final java.lang.String title;
                            |  public java.lang.String title();
                            |  public java.lang.String getTitle();
                            |}
                        }
                    }

                    @spacer_half()

                    @sidebyside((50,50)) {
                        @sourcecode() {
                            |import scala.reflect.BooleanBeanProperty
                            |
                            |class Book {
                            |  @@BooleanBeanProperty var available = _
                            |}
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |  public Book();
                            |
                            |  private final boolean available;
                            |  public boolean available();
                            |  public boolean isAvailable();
                            |}
                        }
                    }

                    @spacer_half()

                    @sidebyside((50,50)) {
                        @sourcecode() {
                            |import scala.reflect.BeanProperty
                            |
                            |class Book(@@BeanProperty var price:Float)
                        }
                        @codesub() {
                            <code>@@BeanProperty</code> erstellt get- und set-Methoden für <em>var</em>
                        }
                    } {
                        @outcode() {
                            |public class Book [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private float price;
                            |  public float price();
                            |  public void price_$eq(float);
                            |  public float getPrice();
                            |  public void setPrice(float);
                            |}
                        }
                    }
                }*@

                <!-- ################################################################################## -->

                @*@headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "Get & Set") {
                    @title: @subtitle
                } {
                    @sidebyside((47,53)) {
                        @sourcecode() {
                            |
                            |
                            |class Book(val title:String) {
                            |  var price = 12.95f
                            |  val available = true
                            |}
                        }
                        @spacer_half()
                        @outcode() {
                            |public class Book extends [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private final java.lang.String title;
                            |  public java.lang.String title();
                            |
                            |
                            |  private float price;
                            |  public float price();
                            |  public void price_$eq(float);
                            |
                            |
                            |
                            |  private final boolean available;
                            |  public boolean available();
                            |}
                        }
                    } {
                        @sourcecode() {
                            |import scala.reflect._
                            |
                            |class Book(@@BeanProperty val title:String) {
                            |  @@BeanProperty var price = 12.95f
                            |  @@BooleanBeanProperty var available = true
                            |}
                        }
                        @spacer_half()
                        @outcode() {
                            |public class Book extends [..] {
                            |  public Book(java.lang.String);
                            |
                            |  private final java.lang.String title;
                            |  public java.lang.String title();
                            |  public java.lang.String getTitle();
                            |
                            |  private float price;
                            |  public float price();
                            |  public void price_$eq(float);
                            |  public float getPrice();
                            |  public void setPrice(float);
                            |
                            |  private final boolean available;
                            |  public boolean available();
                            |  public boolean isAvailable();
                            |}
                        }
                    }
                }*@
            }

            <!-- ################################################################################## -->

            @defining("Ausnahmen") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    @sidebyside((43,57)) {
                        @sourcecode() {
                            |import java.io._
                            |
                            |class Reader(fname: String) {
                            |
                            |  def read() = {
                            |    val fr = new FileReader(fname)
                            |    new BufferedReader(fr).read()
                            |  }
                            |}
                        }
                    } {
                        @outcode() {
                            |public class Reader extends [..] {
                            |  public int read()
                            |  [..]
                            |}
                        }
                        @codesub() {
                            <em>Scala</em> ignoriert <var>geprüfte Ausnahmen</var> <comment>(checked exceptions)</comment>
                        }
                    }

                    @spacer()

                    @sidebyside((43,57)) {
                        @sourcecode() {
                            |import java.io._
                            |
                            |class Reader(fname: String) {
                            |
                            |  @@throws(classOf[IOException])
                            |  def read() = {
                            |    val fr = new FileReader(fname)
                            |    new BufferedReader(fr).read()
                            |  }
                            |}
                        }
                    } {

                    }
                }
            }

            <!-- ################################################################################## -->

            @*@defining("Traits") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    @sidebyside((35,65)) {
                        @sourcecode() {
                            |trait Logging {
                            |  def log(msg: String)
                            |}
                        }
                    } {
                        @outcode() {
                            |public interface Logging {
                            |  public abstract void log(java.lang.String);
                            |}
                        }
                        @codesub() {
                            <em>Trait</em> ohne konkrete Methoden entspricht einem <var>Interface</var>
                        }
                    }

                    @spacer()

                    @sidebyside((35,65)) {
                        @sourcecode(id = "trait") {
                            |trait Logging {
                            |  def log(msg: String) {
                            |    println(msg)
                            |  }
                            |}
                        }
                    } {
                        @traitBytecode
                        @codesub() {
                            <em>Trait</em> mit implementierten Methoden entspricht in einem <var>Interface</var> <br/>
                            @underline("und") einer <var>abstrakten Klasse</var> mit den Methoden als <var>statics</var>
                        }
                    }
                }

                <!-- ################################################################################## -->

                @headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "Vererbung") {
                    @title: @subtitle
                } {
                    @traitBytecode

                    @spacer()

                    @sourcecode(reference = "trait", lang = "java") {
                        |public class Service implements Logging {
                        |
                        |  public void log(String msg) {
                        |    Logging$class.log(this, msg);
                        |  }
                        |}
                    }
                    @codesub() {
                        <var>Java-Klasse</var> implementiert das <var>Interface</var>,
                        Methoden des <em>Traits</em> können via Delegation ausgeführt werden
                    }
                }
            }*@

            <!-- ################################################################################## -->

            @*@defining("Objekte") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle, subsubtitle = "") {
                    @title: @subtitle
                } {
                    @sidebyside((33,66)) {
                        @sourcecode() {
                            |object StringUtil {
                            |  def trim(s: String) {
                            |    s.trim()
                            |  }
                            |}
                        }
                    } {
                        @outcode() {
                            |public final class StringUtil$ extends [..] {
                            |  public static final StringUtil$ MODULE$;
                            |  public void trim(java.lang.String);
                            |  private StringUtil$();
                            |}
                            |
                            |public final class StringUtil extends [..] {
                            |  public static final void trim(java.lang.String);
                            |}
                        }
                        @codesub() {
                            <em>Objekte</em> werden zu Klassen mit den entsprechenden Methoden als <var>static</var><br/>
                            <comment>(delegieren den Aufruf an das generierte Singleton (erkennbar am <code>$</code>))</comment>
                        }
                    }

                    @spacer()

                    @sourcecode(reference = "trait", lang = "java") {
                        |public class Logger {
                        |
                        |  public void log(String msg) {
                        |    println(StringUtil.trim(msg));
                        |  }
                        |}
                    }
                    @codesub() {

                    }
                }
            }*@

            <!-- ################################################################################## -->

            @defining("Funktionen") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    @sidebyside((50,50)) {
                        @sourcecode() {
                            |class Hello {
                            |  def print(f: String => String) {
                            |    println(f("Hello World"))
                            |  }
                            |}
                        }
                    } {
                        @outcode() {
                            |public class Hello extends [..] {
                            |  public void print(scala.Function1);
                            |  public Hello();
                            |}
                        }
                        @codesub() {
                            <code>f: String => String</code> entspricht <code>Function1</code>,<br/>
                            einer Funktion mit einem Parameter
                        }
                    }

                    @spacer()

                    @sidebyside((65,35)) {
                        @sourcecode(reference = "trait", lang = "java") {
                            |import scala.runtime.AbstractFunction1;
                            |
                            |public class Main {
                            |
                            |  public void shoutHello() {
                            |    Hello h = new Hello();
                            |    h.print(new AbstractFunction1&lt;String, String&gt;() {
                            |       public String apply(String arg) {
                            |         return arg.toUpperCase();
                            |       }
                            |    });
                            |  }
                            |}
                        }
                    } {
                        @spacer()
                        @codenote() {
                            <em>Closure</em> kann durch
                            Implementierung von <code>apply</code> der Klasse <code>AbstractFunction1</code>
                            erstellt werden
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("Tipp") { subtitle =>

                @headslide(htmlTitle = title, subtitle = subtitle) {
                    @title: @subtitle
                } {
                    <ul class="indent">
                        <li>
                            Schnittstellen als Java-Klassen bzw. -Interface definieren
                        </li>
                        <li>
                            erlaubt Nutzung aller Scala-Features ohne Einschränkungen zwecks Interoperabilität
                        </li>
                    </ul>
                }
            }
        }
    }
}

@traitBytecode = {
    @outcode() {
        |public abstract class Logging$class extends Object {
        |  public static void log(Logging, java.lang.String);
        |  public static void $init$(Logging);
        |}
        |
        |public interface Logging {
        |  public abstract void log(java.lang.String);
        |}
    }
}