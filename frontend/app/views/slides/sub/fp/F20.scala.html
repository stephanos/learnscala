@implicitSlide = @{ Content.datatypes1 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {

        }

        <!-- ################################################################################## -->

        @defining("Enumeration") { title =>

            @titleslide(title = title, subtitle = "Erstellen", head = true) {

                @sourcecode() {
                    |object WeekDay extends Enumeration {
                    |  val Mon, Tue, Wed, Thu, Fri, Sat, Sun = Value
                    |}
                }
                @codesub2() {

                }

                @spacer2()

                @sourcecode() {
                    |object Direction extends Enumeration {
                    |  val North = Value("Norden")
                    |  val East  = Value("Osten")
                    |  val South = Value("Süden")
                    |  val West  = Value("Westen")
                    |}
                }
                @codesub2() {
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Zugriff", connector = ":") {

                @sourcecode(id = "enum") {
                    |object WeekDay extends Enumeration {
                    |  val Mon, Tue, Wed, Thu, Fri, Sat, Sun = Value
                    |}
                }

                @spacer()

                @indent() {
                    @snippet() {
                        @callblock(reference = "enum") {
                            |WeekDay.Tue.id
                        }
                        @outblock() {
                            |res0: Int = 1
                        }
                        @callblock() {
                            |WeekDay(1)
                        }
                        @outblock() {
                            |res1: WeekDay.Value = Tue
                        }
                        @callblock() {
                            |WeekDay.values
                        }
                        @outblock() {
                            |res2: WeekDay.ValueSet =
                            |  WeekDay.ValueSet(Mon, Tue, Wed, Thu, Fri, Sat, Sun)
                        }
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Tuple") { title =>

            @titleslide(title = title, subtitle = "Erstellen", head = true) {

                @snippet() {
                    @sourceblock() {
                        |val t2 = ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @iseq(true)

                @snippet() {
                    @sourceblock() {
                        |val t2 = "Bob" -> 42
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @iseq(true)

                @snippet() {
                    @sourceblock() {
                        |val t2 = Tuple2("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @codesub2() {
                    unveränderliche Case Class <code>@apilink("Tuple2")</code>
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Erstellen", head = true) {

                @snippet() {
                    @sourceblock() {
                        |val t2 = ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }
                @codesub2() {
                    Tuple mit <em>2</em> Elementen
                }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |val t3 = Tuple2 ("Bob", 42, true)
                    }
                    @outblock() {
                        |t3: (String, Int, Boolean) = (Bob,42,true)
                    }
                }
                @codesub2() {
                    Tuple mit <em>3</em> Elementen
                }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |val t4 = Tuple2 ("Bob", 42, true, 1.79)
                    }
                    @outblock() {
                        |t4: (String, Int, Boolean, Float) = (Bob,42,true,1.79)
                    }
                }
                @codesub2() {
                    Tuple mit <em>4</em> Elementen usw.
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Zugriff", connector = ":") {

                @autocenter {
                    @snippet() {
                        @sourceblock(id = "tuple2") {
                            |val t2 = ("Bob", 42)
                        }
                    }
                }

                @spacer2()

                @sidebyside(gap = 10) {
                    @snippet() {
                        @sourceblock(reference = "tuple2") {
                            |val name = t2._1
                        }
                        @outblock() {
                            |name: String = Bob
                        }
                        @sourceblock() {
                            |val age = t2._2
                        }
                        @outblock() {
                            |age: Int = 42
                        }
                    }
                } {
                    @snippet() {
                        @sourceblock(reference = "tuple2") {
                            |val (name, age) = t2
                        }
                        @outblock() {
                            |name: String = Bob
                            |age: Int = 42
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Pattern Matching", connector = ":") {

                @snippet() {
                    @sourceblock(id = "virgin") {
                        |def doSacrifice(t: (Int, Boolean, Boolean)) = t match {
                        |  case (_, false, _) =>             println ("not female")
                        |  case (_, _, false) =>             println ("not a virgin")
                        |  case (age, _, _) if (age > 24) => println ("too old")
                        |  case (_) =>                       println ("sacrifice her!")
                        |}
                    }
                }

                @spacer()

                @indent() {

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice((40, true, true))
                        }
                        @outblock() {
                            |too old
                        }
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice((21, true, true))
                        }
                        @outblock() {
                            |sacrifice her!
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Beispiele", connector = ":") {

                @snippet() {
                    @sourceblock() {
                        |val (div, mod) = BigInt(12345) /% 12
                    }
                    @outblock() {
                        |div: BigInt = 1028
                        |mod: BigInt = 9
                    }
                }
                @codesub2() {
                    Operator <code>/%</code> liefert Quotient und Rest
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |case class Circle(x: Int, y: Int, r: Int) {
                        |
                        |  def location =
                        |    (x, y)
                        |
                        |  def move(t: (Int, Int)) =
                        |    copy (x + t._1, y + t)
                        |}
                    }
                }
                @codesub2() {
                    xy-Koordinaten gebündelt
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Option") { title =>

            @titleslide(title = title, subtitle = "null", head = true) {

                @spacer()

                @*@image("npe.jpeg", clazz = "naked",
                       source = "http://blog.orbeon.com/2011/04/scalas-optionsomenone.html")*@

                <div class="w50p dcenter fragment">

                    <blockquote class="">
                        <p>
                            Ich nenne es gern meinen Milliarden-Dollar-Fehler: Die Erfindung der <var>null</var>-Referenz 1965.
                        </p>
                        @spacer_half()
                        <p>
                            Sie hat zu unzähligen Fehlern, Schwachstellen und Systemabstürzen geführt,
                            die in den letzten 40 Jahren einen Schaden von bestimmt einer Milliarde Dollar angerichtet haben.
                        </p>
                        <var class="who">
                            Tony Hoare
                        </var>
                    </blockquote>
                </div>
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Rückgabetyp") {

                @sidebyside(gap = 10) {

                    @subhead() {
                        Java-Stil
                    }

                    @sourcecode() {
                        |def getUser(id: Long): User
                    }
                    @codesub2() {
                        <var>null</var> als Rückgabewert? Unklar!
                    }
                } {
                    @subhead() {
                        Scala-Stil
                    }

                    @sourcecode() {
                        |def getUser(id: Long): Option[User]
                    }
                    @codesub2() {
                        Rückgabetyp: <code>Option</code> !
                    }
                }

                @spacer()

                @autocenter {
                    @tipbox() {
                        <code>null</code> vermeiden und auf das typsichere <code>Option</code> setzen!
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("None & Some") { subtitle =>

                @slide(title = title, subtitle = subtitle) {

                    @spacer2()

                    <div>
                        @sidebyside() {
                            <h4 class="tcenter fragment">
                                Some
                            </h4>
                        } {
                            <h4 class="tcenter fragment">
                                None
                            </h4>
                        }

                        @spacer_half()

                        @Images.option()
                    </div>
                }

                <!-- ################################################################################## -->

                @titleslide(title = title, subtitle = "Beispiel", connector = ":") {

                    <div class="w70p dcenter">
                        @sourcecode(id = "toInt") {
                            |def toInt(s: String): Option[Int] =
                            |  try {
                            |    Some(s.toInt)
                            |  } catch {
                            |    case e: Throwable => None
                            |  }
                        }
                    </div>

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet(id = "toInt-some") {
                            @callblock(reference = "toInt") {
                                |val i = toInt("42")
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-some") {
                                |i.get
                            }
                            @outblock() {
                                |res0: Int = 42
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-some") {
                                |i.getOrElse(0)
                            }
                            @outblock() {
                                |res1: Int = 42
                            }
                        }
                        @codesub2() {
                            <code>@apilink("Some")</code>
                        }
                    } {
                        @snippet(id = "toInt-none") {
                            @callblock(reference = "toInt") {
                                |val i = toInt("abc")
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-none") {
                                |i.get
                            }
                            @outblock(error = true) {
                                |NoSuchElementException
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-none") {
                                |i.getOrElse(0)
                            }
                            @outblock() {
                                |res1: Int = 0
                            }
                        }
                        @codesub2() {
                            <code>@apilink("None", isObject = true)</code>
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Pattern Matching", connector = ":") {

                @sourcecode(id = "getuser") {
                    |def getUser(id: Long) =
                    |  if (id < 0) null else ("Bob", 42)
                }
                @codesub2() {
                    eine "unsaubere" Methode (z.B. Java-Code)
                }

                @spacer2()

                @indent() {
                    @sourcecode(reference = "getuser") {
                        |def getUserName(id: Long) =
                        |  Option(getUser(id)) match {
                        |    case Some(u)  => u._1
                        |    case _        => "Unknown"
                        |  }
                    }
                    @codesub2() {
                        <code>Option</code> führt einen null-Test durch <br/>
                        und liefert entsprechend <code>None</code> oder <code>Some</code>
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}