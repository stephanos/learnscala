@implicitSlide = @{ Content.datatypes1 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {

        }

        <!-- ################################################################################## -->

        @defining("Option") { title =>

            @titleslide(title = title) {
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "null") {

                <blockquote class="w50p fragment">
                    <p>
                        Ich nenne es gern meinen Milliarden-Dollar-Fehler: Die Erfindung der <var>null</var>-Referenz 1965.
                    </p>
                    <p>
                        Sie hat zu unzähligen Fehlern, Schwachstellen und Systemabstürzen geführt,
                        die in den letzten 40 Jahren einen Schaden von bestimmt einer Milliarde Dollar angerichtet haben.
                    </p>
                    <var class="who">
                        Tony Hoare
                    </var>
                </blockquote>
            }

            <!-- ################################################################################## -->

            @slide(title = title) {

                @sidebyside((70,30)) {
                    @sourcecode(fragment = false) {
                        |def findPassenger(row: Int, col: String): Passenger
                    }
                } {
                }

                @spacer2()

                @sidebyside((70,30)) {
                    @sourcecode(id = "find_opt") {
                        |case class Passenger(name: String)
                        |
                        |def findPassenger(row: Int, col: String): Option[Passenger] =
                        |   if(row < 1) None else Some(Passenger("Bob"))
                    }
                } {
                }

                @spacer()

                @sidebyside((70,30)) {
                    @snippet() {
                        @callblock(reference = "find_opt") {
                            |val p = findPassenger(2, "A")
                        }
                        @outblock() {
                            |p: Option[Passenger] = Passenger("Bob")
                        }
                        @callblock() {
                            |p.get
                        }
                        @outblock() {
                            |res0: Passenger = Passenger("Bob")
                        }
                    }
                } {
                }

                @spacer()

                @sidebyside((70,30)) {
                    @snippet() {
                        @callblock(reference = "find_opt") {
                            |val p = findPassenger(0, "B")
                        }
                        @outblock() {
                            |res1: Option[Passenger] = None
                        }
                        @callblock() {
                            |p.get
                        }
                        @outblock(error = true) {
                            |java.util.NoSuchElementException: None.get
                        }
                    }
                } {
                }
            }

            <!-- ################################################################################## -->

            @slide(title = title, subtitle = "Pattern Matching") {

                @sidebyside((70,30)) {
                    @snippet() {
                        @sourceblock(id = "opt_match", reference = "find_opt", fragment = false) {
                            |def getName(p: Option[Passenger]) =
                            |  p match {
                            |    case Some(p) => p.name
                            |    case _ => "No Name"
                            |  }
                        }
                    }
                } {
                }

                @spacer()

                @sidebyside((70,30)) {
                    @snippet() {
                        @callblock(reference = "opt_match") {
                            |getName(findPassenger(1, "A"))
                        }
                        @outblock() {
                            |res0: String = Bob
                        }
                        @callblock() {
                            |getName(findPassenger(0, "B"))
                        }
                        @outblock(error = true) {
                            |res1: String = No Name
                        }
                    }
                } {
                }

                @spacer2()

                @sidebyside((70,30)) {
                    @snippet() {
                        @callblock(reference = "opt_match") {
                            |findPassenger(1, "A").map(_.name).getOrElse("No Name")
                        }
                        @outblock() {
                            |res0: String = Bob
                        }
                    }
                } {
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Tuple") { title =>

            @titleslide(title = title, subtitle = "Erstellen") {

                @snippet() {
                    @sourceblock() {
                        |val t2 = ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |val t2 = "Bob" -> 42
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |val t2 = Tuple2 ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @codesub2() {
                    unveränderliche Case Class <code>@apilink("Tuple2")</code>
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Zugreifen", clazz = "wide") {

                <div class="w30p dcenter">
                    @snippet() {
                        @sourceblock(id = "tuple2") {
                            |val t2 = ("Bob", 42)
                        }
                    }
                </div>

                @spacer2()

                <div class="w60p dcenter">
                    @sidebyside(gap = 10) {
                        @snippet() {
                            @sourceblock(reference = "tuple2") {
                                |val name = t2._1
                            }
                            @outblock() {
                                |name: String = Bob
                            }
                            @sourceblock() {
                                |val age = t2._2
                            }
                            @outblock() {
                                |age: Int = 42
                            }
                        }
                    } {
                        @snippet() {
                            @sourceblock(reference = "tuple2") {
                                |val (name, age) = t2
                            }
                            @outblock() {
                                |name: String = Bob
                                |age: Int = 42
                            }
                        }
                    }
                </div>
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Pattern Matching") {

                @snippet() {
                    @sourceblock(id = "virgin") {
                        |def doSacrifice (t: (Int, Boolean, Boolean)) = t match {
                        |    case (_, false, _) =>             println ("not female")
                        |    case (_, _, false) =>             println ("not a virgin")
                        |    case (age, _, _) if (age > 24) => println ("too old")
                        |    case (_) =>                       println ("sacrifice her!")
                        |}
                    }
                }

                @spacer()

                @indent() {

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice ((40, true, true))
                        }
                        @outblock() {
                            |too old
                        }
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice ((21, true, true))
                        }
                        @outblock() {
                            |sacrifice her!
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Beispiele") {

                @snippet() {
                    @sourceblock() {
                        |val (div, mod) = BigInt (12345) /% 12
                    }
                    @outblock() {
                        |div: BigInt = 1028
                        |mod: BigInt = 9
                    }
                }
                @codesub2() {
                    Operator <code>/%</code> liefert Quotient und Rest
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |case class Circle (x: Int, y: Int, r: Int) {
                        |
                        |  def location =
                        |    (x, y)
                        |
                        |  def move (t: (Int, Int)) =
                        |    copy (x + t._1, y + t._2)
                        |}
                    }
                }
                @codesub2() {
                    xy-Koordinaten gebündelt
                }
            }
        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}