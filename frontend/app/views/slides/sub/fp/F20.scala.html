@implicitSlide = @{ Content.datatypes1 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {

        }

        <!-- ################################################################################## -->

        @defining("Tuple") { title =>

            @titleslide(title = title, subtitle = "Erstellen") {

                @snippet() {
                    @sourceblock() {
                        |val t2 = ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |val t2 = "Bob" -> 42
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |val t2 = Tuple2 ("Bob", 42)
                    }
                    @outblock() {
                        |t2: (String, Int) = (Bob,42)
                    }
                }

                @codesub2() {
                    unveränderliche Case Class <code>@apilink("Tuple2")</code>
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Zugreifen", clazz = "wide") {

                @autocenter {
                    @snippet() {
                        @sourceblock(id = "tuple2") {
                            |val t2 = ("Bob", 42)
                        }
                    }
                }

                @spacer2()

                <div class="w60p dcenter">
                    @sidebyside(gap = 10) {
                        @snippet() {
                            @sourceblock(reference = "tuple2") {
                                |val name = t2._1
                            }
                            @outblock() {
                                |name: String = Bob
                            }
                            @sourceblock() {
                                |val age = t2
                            }
                            @outblock() {
                                |age: Int = 42
                            }
                        }
                    } {
                        @snippet() {
                            @sourceblock(reference = "tuple2") {
                                |val (name, age) = t2
                            }
                            @outblock() {
                                |name: String = Bob
                                |age: Int = 42
                            }
                        }
                    }
                </div>
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Pattern Matching") {

                @snippet() {
                    @sourceblock(id = "virgin") {
                        |def doSacrifice (t: (Int, Boolean, Boolean)) = t match {
                        |  case (_, false, _) =>             println ("not female")
                        |  case (_, _, false) =>             println ("not a virgin")
                        |  case (age, _, _) if (age > 24) => println ("too old")
                        |  case (_) =>                       println ("sacrifice her!")
                        |}
                    }
                }

                @spacer()

                @indent() {

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice ((40, true, true))
                        }
                        @outblock() {
                            |too old
                        }
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "virgin") {
                            |doSacrifice ((21, true, true))
                        }
                        @outblock() {
                            |sacrifice her!
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Beispiele") {

                @snippet() {
                    @sourceblock() {
                        |val (div, mod) = BigInt (12345) /% 12
                    }
                    @outblock() {
                        |div: BigInt = 1028
                        |mod: BigInt = 9
                    }
                }
                @codesub2() {
                    Operator <code>/%</code> liefert Quotient und Rest
                }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |case class Circle (x: Int, y: Int, r: Int) {
                        |
                        |  def location =
                        |    (x, y)
                        |
                        |  def move (t: (Int, Int)) =
                        |    copy (x + t._1, y + t)
                        |}
                    }
                }
                @codesub2() {
                    xy-Koordinaten gebündelt
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Option") { title =>

            @titleslide(title = title, subtitle = "null") {

                @spacer()

                @*@image("npe.jpeg", clazz = "naked",
                       source = "http://blog.orbeon.com/2011/04/scalas-optionsomenone.html")*@

                <div class="w50p dcenter fragment">

                    <blockquote class="">
                        <p>
                            Ich nenne es gern meinen Milliarden-Dollar-Fehler: Die Erfindung der <var>null</var>-Referenz 1965.
                        </p>
                        <p>
                            Sie hat zu unzähligen Fehlern, Schwachstellen und Systemabstürzen geführt,
                            die in den letzten 40 Jahren einen Schaden von bestimmt einer Milliarde Dollar angerichtet haben.
                        </p>
                        <var class="who">
                            Tony Hoare
                        </var>
                    </blockquote>
                </div>
            }

            <!-- ################################################################################## -->

            @titleslide(title = title) {

                @sourcecode() {
                    |def getUser (id: Long): User
                }
                @codesub2() {
                    <var>null</var> als Rückgabetyp ?
                }

                @spacer2()

                @sourcecode() {
                    |def getUser (id: Long): Option[User]
                }
                @codesub2() {
                    Rückgabetyp <code>Option</code> !
                }
            }

            <!-- ################################################################################## -->

            @defining("None vs Some") { subtitle =>

                @titleslide(title = title, subtitle = subtitle) {

                    @spacer()

                    <div>
                        @sidebyside() {
                            <h4 class="tcenter fragment">
                                Some
                            </h4>
                        } {
                            <h4 class="tcenter fragment">
                                None
                            </h4>
                        }

                        @spacer_half()

                        @Images.option()
                    </div>
                }

                <!-- ################################################################################## -->

                @titleslide(title = title, subtitle = subtitle, subsubtitle = "Beispiel") {

                    <div class="w70p dcenter">
                        @sourcecode(id = "toInt") {
                            |def toInt(s: String): Option[Int] =
                            |  try {
                            |    Some(s.toInt)
                            |  } catch {
                            |    case e: Throwable => None
                            |  }
                        }
                    </div>

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet(id = "toInt-some") {
                            @callblock(reference = "toInt") {
                                |val i = toInt ("42")
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-some") {
                                |i.get
                            }
                            @outblock() {
                                |res0: Int = 42
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-some") {
                                |i.getOrElse (0)
                            }
                            @outblock() {
                                |res1: Int = 42
                            }
                        }
                        @codesub2() {
                            <code>@apilink("Some")</code>
                        }
                    } {
                        @snippet(id = "toInt-none") {
                            @callblock(reference = "toInt") {
                                |val i = toInt ("abc")
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-none") {
                                |i.get
                            }
                            @outblock(error = true) {
                                |NoSuchElementException
                            }
                        }

                        @spacer_half()

                        @snippet() {
                            @callblock(reference = "toInt-none") {
                                |i.getOrElse (0)
                            }
                            @outblock() {
                                |res1: Int = 0
                            }
                        }
                        @codesub2() {
                            <code>@apilink("None", isObject = true)</code>
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title, subtitle = "Pattern Matching") {

                @sourcecode(id = "getuser") {
                    |def getUser (id: Long) =
                    |  if (id < 0)
                    |    null
                    |  else
                    |    (id, "Bob", 42)
                }

                @spacer()

                @sourcecode(reference = "getuser") {
                    |def getUserName (id: Long) = {
                    |  val usr = Option(getUser (id))
                    |
                    |  usr match {
                    |    case Some (u) => u
                    |    case _        => "Unknown"
                    |  }
                    |}
                }
            }
        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}