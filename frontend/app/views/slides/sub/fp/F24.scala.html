<!--
    TODO
        - example with Options
-->
@implicitSlide = @{ Content.forexpr }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {
            @image("swissarmyknife2.png", clazz = "naked", height = 300)
            @spacer_half()
            Swiss army knife of iteration
        }

        <!-- ################################################################################## -->

        @defining("Syntax") { title =>
            @slide(title = title) {

                @sourcecode() {
                    |for (sequence) expression
                }
                @codesub2() {
                    for-Ausdruck besteht aus 2 Teilen: <em>Sequenz</em> und <em>Ausdruck</em>
                }

                @spacer()

                @sourcecode() {
                    |for (seq_0; seq_1; .. ; seq_n) {
                    |  expression
                    |}
                }

                @spacer()

                <div style="margin: 0 auto;">
                    @sidebyside((45,45)) {
                        @sourcecode() {
                            |for {
                            |  seq_0
                            |  seq_1
                            |  ..
                            |  seq_n
                            |} {
                            |  expression
                            |}
                        }
                    } {
                        @sourcecode() {
                            |for (sequence) {
                            |  expr_0
                            |  expr_1
                            |  ..
                            |  expr_n
                            |}
                        }
                    }
                </div>
            }

            @*@codesub() {
                Jeder for-Ausdruck besteht aus 2 Bestandteilen:
                @spacer()
                <ol class="indent fragments">
                    <li>
                        Sequenz aus
                        @spacer_half()
                        <ul>
                            <li><em>Generatoren</em></li>
                            <li><em>Definitionen</em></li>
                            <li><em>Filtern</em></li>
                        </ul>
                    </li>
                    @spacer_half()
                    <li>
                        <em>Ausdruck</em>
                    </li>
                </ol>
            }*@
        }

        <!-- ################################################################################## -->

        @defining("Generator") { title =>

            @headslide(title = title) {
                @title
            } {
                @sourcecode() {
                    |for (variable <- collection) {
                    |  ...
                    |}
                }

                    @codesub2() {
                        <code>variable</code> wird schrittweise jedes Element aus <code>collection</code> zugewiesen
                    }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |for (i <- 1 to 10) {
                        |  print(i + " ")
                        |}
                    }
                    @outblock() {
                        |1 2 3 4 5 6 7 8 9 10
                    }
                }

                    @codesub() {
                        Methode <code>to</code> erstellt Kollektion mit Zahlen von 1 bis 10
                    }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |for (i <- "Hello") print(i + " ")
                    }
                    @outblock() {
                        |H e l l o
                    }
                }

                    @codesub() {
                        String <code>Hello</code> ist eine Kollektion aus Zeichen
                    }
            }

            <!-- ################################################################################## -->

            @headslide(title = title) {
                @title
            } {
                @sourcecode() {
                    |for (var1 <- collect1; var2 <- collect2) {
                    |  ...
                    |}
                }

                    @codesub2() {
                        2. Generator entspricht einer inneren Schleife
                    }

                @spacer2()

                @snippet() {
                    @sourceblock() {
                        |for (i <- 1 to 3; j <- 1 to 3)
                        |  print (i, j)
                    }
                    @outblock() {
                        |(1,1)(1,2)(1,3)(2,1)(2,2)(2,3)(3,1)(3,2)(3,3)
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Definition") { title =>

            @headslide(title = title) {
                @title
            } {
                @snippet() {
                    @sourceblock() {
                        |for (i <- 1 to 10; double = i * 2)
                        |  print (double + " ")
                    }
                    @outblock() {
                        |2 4 6 8 10 12 14 16 18 20
                    }
                }

                    @codesub2() {
                        Definitionen führen zusätzliche Variablen ein
                    }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |for (i <- 1 to 2; double = i * 2; j <- i to double)
                        |  print (j, double)
                    }
                    @outblock() {
                        |(1,2)(2,2)(2,4)(3,4)(4,4)
                    }
                }

                    @codesub() {
                        Definitionen können in beiden Blöcken verwendet werden
                    }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |for {
                        |  i <- 1 to 10
                        |  prev = i - 1
                        |  next = i + 1
                        |} print (prev, next)
                    }
                    @outblock() {
                        |(0,2)(1,3)(2,4)(3,5)(4,6)(5,7)(6,8)(7,9)(8,10)(9,11)
                    }
                }

                    @codesub() {
                        Definitionen können beliebig oft verwendet werden
                    }
            }
        }

        <!-- ################################################################################## -->

        @defining("Filter") { title =>

            @headslide(title = title) {
                @title
            } {
                @snippet() {
                    @sourceblock() {
                        |for (i <- 1 to 10; if i % 2 == 0) print (i + " ")
                    }
                    @outblock() {
                        |2 4 6 8 10
                    }
                }

                    @codesub2() {
                        Filter ist ein Ausdruck vom Typ <code>Boolean</code>
                        und entfernt Elemente des Generators für die der Ausdruck unwahr ist
                    }

                @spacer2()

                @sidebyside() {
                    @snippet() {
                        @sourceblock() {
                            |for {
                            |  i <- 1 to 10         // Generator
                            |  if i % 2 == 0        // Filter #1
                            |  if i % 3 == 0        // Filter #2
                            |} print (i + " ")
                        }
                        @outblock() {
                            |6
                        }
                    }

                        @codesub() {
                            Mehrere Filter werden einfach sequentiell angewandt
                        }
                } {
                    @snippet() {
                        @sourceblock() {
                            |for {
                            |  i <- 1 to 10         // Generator
                            |  sqrt = Math.sqrt(i)  // Definition
                            |  if sqrt % 3 == 0     // Filter
                            |} print (i + " ")
                        }
                        @outblock() {
                            |9
                        }
                    }
                }

                    @codesub() {
                        Filter können Bezug auf Definitionen nehmen
                    }
            }
        }

        <!-- ################################################################################## -->

        @defining("Yield") { title =>

            @headslide(title = title) {
                @title
            } {
                @snippet() {
                    @sourceblock() {
                        |for {
                        |  i <- 1 to 10
                        |} yield i
                    }
                    @outblock() {
                        |res0: IndexedSeq[Int] =
                        |  Vector(1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
                    }
                }

                    @codesub2() {
                        <code>yield</code> gibt dem for-Ausdruck einen Rückgabewert
                    }

                @spacer()

                @snippet() {
                    @sourceblock() {
                        |for {
                        |  i <- 1 to 10
                        |} yield {
                        |  val r = i + 1
                        |  r
                        |}
                    }
                    @outblock() {
                        |res0: IndexedSeq[Int] =
                        |  Vector(2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("Beispiel") { title =>

            @defining("") { subtitle =>

                @slide(title = title, subtitle = subtitle) {
                    @sourcecode(id = "people") {
                        |val ppl = List("Anna" -> "Adams", "Adam" -> "Adams", "Barb" -> "Brown", "Bill" -> "Brown")
                    }

                    @spacer()

                    @fragment {
                        <div class="tcenter">
                            <span class="big underline">
                                Vornamen die mit "B" beginnen ?
                            </span>
                        </div>
                    }

                    @spacer2()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock(reference = "people") {
                                |for {
                                |  p <- ppl                 // Generator
                                |  firstname = p._1         // Definition
                                |  if p._1.startsWith("B")  // Filter
                                |} print(firstname + " ")
                            }
                            @outblock() {
                                |Barb Bill
                            }
                        }
                        @codesub2() {
                            via for-Ausdruck
                        }
                    } {
                        @snippet() {
                            @callblock(reference = "people") {
                                |ppl filter {
                                |  p =>
                                |    val firstname = p._1
                                |    firstname.startsWith("B")
                                |} foreach {p => print(p._1 + " ")}
                            }
                            @outblock() {
                                |Barb Bill
                            }
                        }
                        @codesub2() {
                            via Funktionen
                        }
                    }

                    @*
                    @spacer()

                    @sidebyside() {
                        @snippet() {
                            @callblock(reference = "people") {
                                |for {
                                |  p <- ppl                 // Generator
                                |  firstname = p._1         // Definition
                                |  if p._1.startsWith("B")  // Filter
                                |} yield firstname
                            }
                            @outblock() {
                                |res0: List[String] = List(Barb, Bill)
                            }
                        }
                        @codesub() {
                            Rückgabe via for-Ausdruck
                        }
                    } {
                        @snippet() {
                            @callblock(reference = "people") {
                                |ppl filter {
                                |  p =>
                                |    val firstname = p._1
                                |    firstname.startsWith("B")
                                |} map (_._1)
                            }
                            @outblock() {
                                |res0: List[String] = List(Barb, Bill)
                            }
                        }
                        @codesub() {
                            Rückgabe via Funktionen höherer Ordnung
                        }
                    }
                    *@
                }

                <!-- ################################################################################## -->

                @slide(title = title, subtitle = subtitle) {

                    @sourcecode() {
                        |val ppl = List("Anna" -> "Adams", "Adam" -> "Adams", "Barb" -> "Brown", "Bill" -> "Brown")
                    }

                    @spacer()

                    @fragment {
                        <div class="tcenter">
                            <span class="big underline">
                                Welche Personen haben den gleichen Nachnamen ?
                            </span>
                        </div>
                    }

                    @spacer2()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock(reference = "people") {
                                |for {
                                |  p1 <- ppl                 // Gener. #1
                                |  p2 <- ppl filter(_ != p1) // Gener. #2
                                |  if p1 == p2         // Filter
                                |} yield (p1, p2)
                            }
                            @outblock() {
                                |List(((Anna,Adams),(Adam,Adams))
                                |     ((Adam,Adams),(Anna,Adams))
                                |     ((Barb,Brown),(Bill,Brown))
                                |     ((Bill,Brown),(Barb,Brown)))
                            }
                        }
                        @codesub2() {
                            via for-Ausdruck
                        }
                    } {
                        @snippet() {
                            @callblock(reference = "people") {
                                |ppl flatMap { p1 =>
                                |  ppl filter {
                                |    p2 => p1 != p2
                                |  } filter {
                                |    p2 => p1 == p2
                                |  } map {
                                |    p2 => (p1, p2)
                                |  }
                                |}
                            }
                            @outblock() {
                                |List(((Anna,Adams),(Adam,Adams))
                                |     ((Adam,Adams),(Anna,Adams))
                                |     ((Barb,Brown),(Bill,Brown))
                                |     ((Bill,Brown),(Barb,Brown)))
                            }
                        }
                        @codesub2() {
                            via Funktionen
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @*
            def createConnection(conn_url: Option[String],
                                conn_user: Option[String],
                                conn_pw: Option[String]) : Option[Connection] =
              for {
                url <- conn_url
                user <- conn_user
                pw <- conn_pw
              } yield DriverManager.getConnection(url, user, pw)
            *@

            @*
            @defining("B") { subtitle =>

                @slide(title = title, subtitle = subtitle) {

                }
            }
            *@
        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}