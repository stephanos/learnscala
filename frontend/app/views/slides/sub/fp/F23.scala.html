<!--
    - higher order functions
    - map
    - fold
    - filter
-->
@implicitSlide = @{ Content.funktionen3 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {

        }

        <!-- ################################################################################## -->

        @defining("HOF") { title =>

            @defining("foreach") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def foreach[A] (f: Elem => A): Unit
                        |}
                    }
                    @codesub2() {
                        führt Funktion auf jedes Element aus
                    }

                    @spacer2()

                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers foreach (n => println (n))
                        }
                        @outblock() {
                            |1
                            |2
                            |3
                            |4
                        }
                    }
                    @codesub2() {
                        Ausgabe aller Elemente
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("filter") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @autocenter {
                        @sourcecode() {
                            |trait Traversable[A] {
                            |  def filter (f: A => Boolean): Traversable[A]
                            |}
                        }
                        @codesub2() {
                            überführt Elemente, für die <code>f</code> wahr ist, in eine neue Liste
                        }
                    }

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers filter (n => n % 2 == 0)
                            }
                            @outblock() {
                                |res0: List[Int] = List(2, 4)
                            }
                        }
                        @codesub2() {
                            Liste der geraden Zahlen
                        }
                    } {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers filter { n =>
                                |   val isEven = (n % 2 == 0)
                                |   println (n + "? " + isEven)
                                |   isEven
                                |}
                            }
                            @outblock() {
                                |1? false
                                |2? true
                                |3? false
                                |4? true
                                |res0: List[Int] = List(1, 2)
                            }
                        }
                        @codesub2() {
                            mit Zwischenschritten
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("map") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @autocenter {
                        @sourcecode() {
                            |trait Traversable[A] {
                            |  def map[B] (f: (A) => B): Traversable[B]
                            |}
                        }
                        @codesub2() {
                            wendet Funktion auf jedes Element an und liefert Ergebnisliste
                        }
                    }

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers map (n => n * 2)
                            }
                            @outblock() {
                                |res0: List[Int] = List(2, 4, 6, 8)
                            }
                        }
                        @codesub2() {
                            Liste mit verdoppelten Werten
                        }
                    } {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers map {n =>
                                |   val res = (n * 2)
                                |   println (n + " => " + res)
                                |   res
                                |}
                            }
                            @outblock() {
                                |1 => 2
                                |2 => 4
                                |3 => 6
                                |4 => 8
                                |res0: List[Int] = List(2, 4, 6, 8)
                            }
                        }
                        @codesub2() {
                            mit Zwischenschritten
                        }
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @quiz() {
            @Quiz.functions3()
        }

        <!-- ################################################################################## -->

        @defining("foldLeft") { title =>

            @titleslide(title = title) {

                @*
                println((1 to 1000000) reduceLeft(_ + _))  // tail rec
                println((1 to 1000000) reduceRight(_ + _)) // overflow
                *@

                @autocenter {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def foldLeft[B] (z: B) (f: (B, A) => B): B
                        |}
                    }
                    @codesub2() {
                        transformiert Elemente vom Typ <code>A</code> in Ergebnis vom Typ <code>B</code>
                    }
                }

                @spacer()

                @sidebyside(gap = 10) {

                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers.foldLeft (0) (
                            |   (res, num) => res + num
                            |)
                        }
                        @outblock() {
                            |res0: Int = 10
                        }
                    }
                    @codesub2() {
                        Summe der Elemente
                    }
                } {
                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers.foldLeft (0) {
                            |  (res, num) =>
                            |    println ("= " + res + " + " + num)
                            |    res + num
                            |}
                        }
                        @outblock() {
                            |= 0 + 1
                            |= 1 + 2
                            |= 3 + 3
                            |= 6 + 4
                            |res1: Int = 10
                        }
                    }
                    @codesub2() {
                        mit Zwischenergebnissen
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("flatMap") { title =>

            @slide(title = title) {

                @sidebyside(gap = 10) {
                    @snippet() {
                        @sourceblock(id = "config") {
                            |def getConf (s: String) =
                            |  Option (System getProperty s)
                        }
                        @outblock() {
                            |getConf: (s: String)Option[String]
                        }
                    }
                    @codesub2() {
                        <em>(A)</em> Systemparameter auslesen
                    }
                } {
                    @snippet() {
                        @sourceblock(id = "tonum", reference = "config") {
                            |def toNum (s: String) =
                            |  try {
                            |    Some (s toDouble)
                            |  } catch {
                            |    case e: Throwable => None
                            |  }
                        }
                        @outblock() {
                            |toNum: (s: String)Option[Double]
                        }
                    }
                    @codesub2() {
                        <em>(B)</em> String in Fließkommazahl umwandeln
                    }
                }

                @spacer2()

                @sidebyside(gap = 10) {
                    @fragment {
                        <h4 class="tcenter">map</h4>
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "tonum") {
                            |val n = "java.specification.version"
                            |val r = getConf(n) map (s => toNum s)
                        }
                        @outblock() {
                            |r: Option[Option[Double]] = Some(Some(1.6))
                        }
                    }
                } {
                    @fragment {
                        <h4 class="tcenter">flatMap</h4>
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "tonum") {
                            |val n = "java.specification.version"
                            |val r = getConf(n) flatMap (s => toNum s)
                        }
                        @outblock() {
                            |r: Option[Double] = Some(10.6)
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title) {

                @autocenter {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def flatMap[B] (f: A => Traversable[B]): Traversable[B]
                        |}
                    }
                }

                @spacer2()

                @autocenter {
                    @snippet() {
                        @callblock() {
                            |val empl = Map (
                            |   1 -> "Adam",
                            |   5 -> "Bob",
                            |   9 -> "Carl" )
                            |
                            |(1 to 4) flatMap (n => empl get n)
                        }
                        @outblock() {
                            |res0: IndexedSeq[String] = Vector(Adam)
                        }
                    }
                    @codesub2() {
                        Mitarbeiter mit ID zwischen 1 und 4
                    }
                }

                @*
                @snippet() {
                    @callblock() {
                        |TODO
                    }
                    @outblock() {
                        |res0:
                    }
                }
                @codesub2() {
                    TODO
                }
                *@
            }
        }

        <!-- ################################################################################## -->

        @slide(title = "Beispiel") {

        }

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}