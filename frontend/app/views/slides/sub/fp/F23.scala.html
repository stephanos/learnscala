<!--
    TODO
        - good flatMap & Option example
-->
@implicitSlide = @{ Content.funktionen3 }

@defining(implicitSlide.label) { implicit topic =>

    @layout.slidedeck(topic) {

        @slidehead() {
            @topic
        } {

        }

        <!-- ################################################################################## -->

        @defining("HOF") { title =>

            @defining("foreach") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def foreach[A] (f: Elem => A): Unit
                        |}
                    }
                    @codesub2() {
                        führt Funktion auf jedes Element aus
                    }

                    @spacer2()

                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers foreach (n => println (n))
                        }
                        @outblock() {
                            |1
                            |2
                            |3
                            |4
                        }
                    }
                    @codesub2() {
                        Ausgabe aller Elemente
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("filter") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @autocenter {
                        @sourcecode() {
                            |trait Traversable[A] {
                            |  def filter (f: A => Boolean): Traversable[A]
                            |}
                        }
                        @codesub2() {
                            überführt Elemente, für die <code>f</code> wahr ist, in eine neue Liste
                        }
                    }

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers filter (n => n % 2 == 0)
                            }
                            @outblock() {
                                |res0: List[Int] = List(2, 4)
                            }
                        }
                        @codesub2() {
                            Liste der geraden Zahlen
                        }
                    } {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers filter { n =>
                                |   val isEven = (n % 2 == 0)
                                |   println (n + "? " + isEven)
                                |   isEven
                                |}
                            }
                            @outblock() {
                                |1? false
                                |2? true
                                |3? false
                                |4? true
                                |res0: List[Int] = List(1, 2)
                            }
                        }
                        @codesub2() {
                            mit Zwischenschritten
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @defining("map") { subtitle =>

                @headslide(title = title, subtitle = subtitle) {
                    @subtitle
                } {
                    @autocenter {
                        @sourcecode() {
                            |trait Traversable[A] {
                            |  def map[B] (f: (A) => B): Traversable[B]
                            |}
                        }
                        @codesub2() {
                            wendet Funktion auf jedes Element an und liefert Ergebnisliste
                        }
                    }

                    @spacer()

                    @sidebyside(gap = 10) {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers map (n => n * 2)
                            }
                            @outblock() {
                                |res0: List[Int] = List(2, 4, 6, 8)
                            }
                        }
                        @codesub2() {
                            Liste mit verdoppelten Werten
                        }
                    } {
                        @snippet() {
                            @callblock() {
                                |val numbers = List (1, 2, 3, 4)
                                |
                                |numbers map {n =>
                                |   val res = (n * 2)
                                |   println (n + " => " + res)
                                |   res
                                |}
                            }
                            @outblock() {
                                |1 => 2
                                |2 => 4
                                |3 => 6
                                |4 => 8
                                |res0: List[Int] = List(2, 4, 6, 8)
                            }
                        }
                        @codesub2() {
                            mit Zwischenschritten
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @headslide(title = title, subtitle = "Weitere") {
                usw.
            } {
                @autocenter {
                    @sourcecode(id = "list1234") {
                        |val nums = List(1, 2, 3, 4)
                    }
                }

                @spacer2()

                @sidebyside(gap = 10) {
                    @snippet() {
                        @callblock(reference = "list1234") {
                            |nums partition (n => n % 2 == 0)
                        }
                        @outblock() {
                            |res0: (List[Int], List[Int]) =
                            |   (List(2, 4),List(1, 3))
                        }
                    }
                    @codesub2() {
                        Teilt Liste abgängig vom Wahrheitswert der Funktion
                    }

                    @spacer2()

                    @snippet() {
                        @callblock(reference = "list1234") {
                            |nums exists (n => n % 4 == 0)
                        }
                        @outblock() {
                            |res0: Boolean = true
                        }
                    }
                    @codesub2() {
                        Überprüft ob ein Element die Bedingung erfüllt
                    }

                } {
                    @snippet() {
                        @callblock(reference = "list1234") {
                            |nums groupBy (n => n % 2)
                        }
                        @outblock() {
                            |res0: Map[Int,List[Int]] =
                            |  Map(1 -> List(1, 3), 0 -> List(2, 4))
                        }
                    }
                    @codesub2() {
                        Gruppiert Elemente
                    }

                    @spacer2()

                    @snippet() {
                        @callblock(reference = "list1234") {
                            |nums takeWhile (n => n <= 2)
                        }
                        @outblock() {
                            |res0: List[Int] = List(1, 2)
                        }
                    }
                    @codesub2() {
                        Extrahiert Teilliste für die die Funktion wahr ist
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @quiz() {
            @Quiz.functions3()
        }

        <!-- ################################################################################## -->

        @defining("foldLeft") { title =>

            @titleslide(title = title) {

                @*
                println((1 to 1000000) reduceLeft(_ + _))  // tail rec
                println((1 to 1000000) reduceRight(_ + _)) // overflow
                *@

                @autocenter {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def foldLeft[B] (z: B) (f: (B, A) => B): B
                        |}
                    }
                    @codesub2() {
                        transformiert Elemente vom Typ <code>A</code> in Ergebnis vom Typ <code>B</code>
                    }
                }

                @spacer()

                @sidebyside(gap = 10) {

                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers.foldLeft (0) (
                            |   (res, num) => res + num
                            |)
                        }
                        @outblock() {
                            |res0: Int = 10
                        }
                    }
                    @codesub2() {
                        Summe der Elemente
                    }
                } {
                    @snippet() {
                        @callblock() {
                            |val numbers = List (1, 2, 3, 4)
                            |
                            |numbers.foldLeft (0) {
                            |  (res, num) =>
                            |    println ("= " + res + " + " + num)
                            |    res + num
                            |}
                        }
                        @outblock() {
                            |= 0 + 1
                            |= 1 + 2
                            |= 3 + 3
                            |= 6 + 4
                            |res1: Int = 10
                        }
                    }
                    @codesub2() {
                        mit Zwischenergebnissen
                    }
                }
            }
        }

        <!-- ################################################################################## -->

        @defining("flatMap") { title =>

            @slide(title = title) {

                @sidebyside(gap = 10) {
                    @snippet() {
                        @sourceblock(id = "config") {
                            |def getConf (s: String) =
                            |  Option (System getProperty s)
                        }
                        @outblock() {
                            |getConf: (s: String)Option[String]
                        }
                    }
                    @codesub2() {
                        <em>(A)</em> Systemparameter auslesen
                    }
                } {
                    @snippet() {
                        @sourceblock(id = "tonum", reference = "config") {
                            |def toNum (s: String) =
                            |  try {
                            |    Some (s toDouble)
                            |  } catch {
                            |    case e: Throwable => None
                            |  }
                        }
                        @outblock() {
                            |toNum: (s: String)Option[Double]
                        }
                    }
                    @codesub2() {
                        <em>(B)</em> String in Fließkommazahl umwandeln
                    }
                }

                @spacer2()

                @sidebyside(gap = 10) {
                    @fragment {
                        <h4 class="tcenter">map</h4>
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "tonum") {
                            |val n = "java.specification.version"
                            |val r = getConf(n) map (s => toNum s)
                        }
                        @outblock() {
                            |r: Option[Option[Double]] = Some(Some(1.6))
                        }
                    }
                } {
                    @fragment {
                        <h4 class="tcenter">flatMap</h4>
                    }

                    @spacer()

                    @snippet() {
                        @callblock(reference = "tonum") {
                            |val n = "java.specification.version"
                            |val r = getConf(n) flatMap (s => toNum s)
                        }
                        @outblock() {
                            |r: Option[Double] = Some(10.6)
                        }
                    }
                }
            }

            <!-- ################################################################################## -->

            @titleslide(title = title) {

                @autocenter {
                    @sourcecode() {
                        |trait Traversable[A] {
                        |  def flatMap[B] (f: A => Traversable[B]): Traversable[B]
                        |}
                    }
                }

                @spacer2()

                @sidebyside() {
                    @snippet() {
                        @callblock() {
                            |val empl =
                            |  Map (1->"Adam", 5->"Bob", 9->"Carl")
                            |
                            |(1 to 4) flatMap (n => empl get n)
                        }
                        @outblock() {
                            |res0: IndexedSeq[String] = Vector(Adam)
                        }
                    }
                    @codesub2() {
                        Mitarbeiter mit ID von 1 bis 4
                    }
                } {
                    @snippet() {
                        @callblock() {
                            |val empl =
                            |  Map (1->"Adam", 5->"Bob", 9->"Carl")
                            |
                            |(1 to 4) flatMap {n =>
                            |  val e = empl get n
                            |  println (e)
                            |  e
                            |}
                        }
                        @outblock() {
                            |Some(Adam)
                            |None
                            |None
                            |None
                            |res0: IndexedSeq[String] = Vector(Adam)
                        }
                    }
                    @codesub2() {
                        mit Zwischenergebnissen
                    }
                }

                @*
                @snippet() {
                    @callblock() {
                        |TODO
                    }
                    @outblock() {
                        |res0:
                    }
                }
                @codesub2() {
                    TODO
                }
                *@
            }
        }

        <!-- ################################################################################## -->

        @*
        @slide(title = "Beispiel") {

            @sidebyside(gap = 10) {
                @sourcecode(id = "empl") {
                    |case class Empl (
                    |   name: String,
                    |   age: Int,
                    |   started: Int,
                    |   nickname: Option[String] = None
                    |)
                    |
                    |val empl = List (
                    |    Empl ("Adam", 42, 20),
                    |    Empl ("Bob",  32, 10, Some("Mr B")),
                    |    Empl ("Carl", 46,  6),
                    |    Empl ("Dan",  22,  3),
                    |    Empl ("Ed",   51, 27),
                    |    Empl ("Fred", 24, 10),
                    |    Empl ("Gus",  31,  9, Some("Kingpin")),
                    |    Empl ("Han",  39,  6),
                    |    Empl ("Ian",  23, 15),
                    |    Empl ("Jim",  59, 19, Some("J")),
                    |    Empl ("Kurt", 41,  8, Some("K")),
                    |    Empl ("Liam", 60, 40),
                    |    Empl ("Mel",  65, 10),
                    |    Empl ("Nina", 47,  4, Some("El Nino")),
                    |    Empl ("Otis", 34,  8),
                    |    Empl ("Pia",  31, 12)
                    |)
                }
            } {
                @snippet() {
                    @callblock(reference = "empl") {
                        |empl filter { e =>
                        |    e.started > 20
                        |  } map { e =>
                        |    (e, e.age - e.started)
                        |  } foreach { t =>
                        |    println (t._1.name +
                        |      " started at age " + t._2)
                        |  }
                    }
                    @outblock() {
                        |Ed started at age 24
                        |Liam started at age 20
                    }
                }

                @spacer()

                @snippet() {
                    @callblock(reference = "empl") {
                        |empl filter { e =>
                        |    e.started > 20
                        |  } map { e =>
                        |    (e, e.age - e.started)
                        |  } foreach { t =>
                        |    println (t._1.name +
                        |      " started at age " + t._2)
                        |  }
                    }
                    @outblock() {
                        |Ed started at age 24
                        |Liam started at age 20
                    }
                }
            }
        }
        *@

        <!-- ################################################################################## -->

        @uebung(implicitSlide.id)
    }
}